# CryptoLaunch Frontend Deployment Workflow
#
# This workflow builds and deploys the frontend to your hosting platform.
#
# SETUP INSTRUCTIONS:
# 1. Add the following secrets to your GitHub repository:
#    - VITE_SUPABASE_URL
#    - VITE_SUPABASE_SUPABASE_ANON_KEY
#    - VITE_CHAIN_ID
#    - VITE_RPC_URL
#    - VITE_WALLETCONNECT_PROJECT_ID
#    - VITE_LAUNCHPAD_FACTORY_[NETWORK]
#    - VITE_VESTING_CONTRACT_[NETWORK]
#    - VITE_WHITELIST_[NETWORK]
#
# 2. For Vercel: Add VERCEL_TOKEN, VERCEL_ORG_ID, VERCEL_PROJECT_ID
# 3. For Netlify: Add NETLIFY_AUTH_TOKEN, NETLIFY_SITE_ID
#
# See DEPLOYMENT.md for detailed instructions.

name: Deploy Frontend

on:
  push:
    branches:
      - main
      - production
    paths-ignore:
      - 'contracts/**'
      - '**.md'
  workflow_dispatch:
    inputs:
      environment:
        description: 'Deployment environment'
        required: true
        default: 'preview'
        type: choice
        options:
          - preview
          - production

env:
  NODE_VERSION: '20'

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Create .env file
        run: |
          cat << EOF > .env
          VITE_SUPABASE_URL=${{ secrets.VITE_SUPABASE_URL }}
          VITE_SUPABASE_SUPABASE_ANON_KEY=${{ secrets.VITE_SUPABASE_SUPABASE_ANON_KEY }}
          VITE_CHAIN_ID=${{ secrets.VITE_CHAIN_ID }}
          VITE_CHAIN_NAME=${{ secrets.VITE_CHAIN_NAME }}
          VITE_RPC_URL=${{ secrets.VITE_RPC_URL }}
          VITE_EXPLORER_BASE_URL=${{ secrets.VITE_EXPLORER_BASE_URL }}
          VITE_WALLETCONNECT_PROJECT_ID=${{ secrets.VITE_WALLETCONNECT_PROJECT_ID }}
          VITE_LAUNCHPAD_FACTORY_ARBITRUM=${{ secrets.VITE_LAUNCHPAD_FACTORY_ARBITRUM }}
          VITE_VESTING_CONTRACT_ARBITRUM=${{ secrets.VITE_VESTING_CONTRACT_ARBITRUM }}
          VITE_WHITELIST_ARBITRUM=${{ secrets.VITE_WHITELIST_ARBITRUM }}
          VITE_LAUNCHPAD_FACTORY_BASE=${{ secrets.VITE_LAUNCHPAD_FACTORY_BASE }}
          VITE_VESTING_CONTRACT_BASE=${{ secrets.VITE_VESTING_CONTRACT_BASE }}
          VITE_WHITELIST_BASE=${{ secrets.VITE_WHITELIST_BASE }}
          VITE_RPC_URL_MAINNET=${{ secrets.VITE_RPC_URL_MAINNET }}
          VITE_RPC_URL_ARBITRUM=${{ secrets.VITE_RPC_URL_ARBITRUM }}
          VITE_RPC_URL_BASE=${{ secrets.VITE_RPC_URL_BASE }}
          VITE_RPC_URL_POLYGON=${{ secrets.VITE_RPC_URL_POLYGON }}
          VITE_RPC_URL_OPTIMISM=${{ secrets.VITE_RPC_URL_OPTIMISM }}
          EOF

      - name: Type check
        run: npm run typecheck

      - name: Lint
        run: npm run lint

      - name: Build
        run: npm run build

      - name: Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: dist
          path: dist
          retention-days: 7

  # ============================================================================
  # Vercel Deployment (uncomment to enable)
  # ============================================================================
  # deploy-vercel:
  #   name: Deploy to Vercel
  #   needs: build
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v4
  #
  #     - name: Download build artifact
  #       uses: actions/download-artifact@v4
  #       with:
  #         name: dist
  #         path: dist
  #
  #     - name: Deploy to Vercel
  #       uses: amondnet/vercel-action@v25
  #       with:
  #         vercel-token: ${{ secrets.VERCEL_TOKEN }}
  #         vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
  #         vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
  #         working-directory: ./
  #         vercel-args: ${{ github.ref == 'refs/heads/production' && '--prod' || '' }}

  # ============================================================================
  # Netlify Deployment (uncomment to enable)
  # ============================================================================
  # deploy-netlify:
  #   name: Deploy to Netlify
  #   needs: build
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Download build artifact
  #       uses: actions/download-artifact@v4
  #       with:
  #         name: dist
  #         path: dist
  #
  #     - name: Deploy to Netlify
  #       uses: nwtgck/actions-netlify@v3.0
  #       with:
  #         publish-dir: './dist'
  #         production-branch: production
  #         github-token: ${{ secrets.GITHUB_TOKEN }}
  #         deploy-message: "Deploy from GitHub Actions"
  #       env:
  #         NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
  #         NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
